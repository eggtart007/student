<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>美摄SDK For Android: 详细开发引导</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">美摄SDK For Android
   &#160;<span id="projectnumber">2.4.3.14</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>首页</span></a></li>
      <li><a href="namespaces.html"><span>命名空间</span></a></li>
      <li><a href="annotated.html"><span>类</span></a></li>
      <li><a href="files.html"><span>文件</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">详细开发引导 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>1 <a class="el" href="Tutorial.md.html#概述">概述</a><ul>
<li>1.1 <a class="el" href="Tutorial.md.html#支持格式">支持格式</a></li>
<li>1.2 <a class="el" href="Tutorial.md.html#注意事项">注意事项</a><ul>
<li>1.2.1 <a class="el" href="Tutorial.md.html#限制">限制</a></li>
<li>1.2.2 <a class="el" href="Tutorial.md.html#运行环境">运行环境</a></li>
<li>1.2.3 <a class="el" href="Tutorial.md.html#重要提示">重要提示</a></li>
</ul>
</li>
</ul>
</li>
<li>2 <a class="el" href="Tutorial.md.html#快速接入">快速接入</a><ul>
<li>2.1 <a class="el" href="Tutorial.md.html#导入库文件">导入库文件</a></li>
</ul>
</li>
<li>3 <a class="el" href="Tutorial.md.html#使用说明">使用说明</a><ul>
<li>3.1 <a class="el" href="Tutorial.md.html#录制">录制</a><ul>
<li>3.1.1 <a class="el" href="Tutorial.md.html#从CaptureDeviceCallback接口派生">从CaptureDeviceCallback接口派生</a></li>
<li>3.1.2 <a class="el" href="Tutorial.md.html#NvsStreamingContext类">NvsStreamingContext类</a></li>
<li>3.1.3 <a class="el" href="Tutorial.md.html#用NvsLiveWindow类预览">用NvsLiveWindow类预览</a></li>
<li>3.1.4 <a class="el" href="Tutorial.md.html#预览前的准备">预览前的准备</a></li>
<li>3.1.5 <a class="el" href="Tutorial.md.html#开启预览">开启预览</a><ul>
<li>3.1.5.1 <a class="el" href="Tutorial.md.html#带美颜录制和不带美颜录制">带美颜录制和不带美颜录制</a></li>
</ul>
</li>
<li>3.1.6 <a class="el" href="Tutorial.md.html#录制与停止录制">录制与停止录制</a></li>
<li>3.1.7 <a class="el" href="Tutorial.md.html#录制参数调节">录制参数调节</a></li>
<li>3.1.8 <a class="el" href="Tutorial.md.html#美颜">美颜</a></li>
<li>3.1.9 <a class="el" href="Tutorial.md.html#采集特效（滤镜）">采集特效（滤镜）</a><ul>
<li>3.1.9.1 <a class="el" href="Tutorial.md.html#内建采集特效">内建采集特效</a></li>
<li>3.1.9.2 <a class="el" href="Tutorial.md.html#扩展采集特效">扩展采集特效</a></li>
</ul>
</li>
</ul>
</li>
<li>3.2 <a class="el" href="Tutorial.md.html#编辑">编辑</a><ul>
<li>3.2.1 <a class="el" href="Tutorial.md.html#创建timeline设定视频尺寸">创建timeline设定视频尺寸</a></li>
<li>3.2.2 <a class="el" href="Tutorial.md.html#多段视频、图片混编">多段视频、图片混编</a></li>
<li>3.2.3 <a class="el" href="Tutorial.md.html#播放与定位预览">播放与定位预览</a></li>
<li>3.2.4 <a class="el" href="Tutorial.md.html#视频裁剪">视频裁剪</a></li>
<li>3.2.5 <a class="el" href="Tutorial.md.html#从轨道上移除片段">从轨道上移除片段</a></li>
<li>3.2.6 <a class="el" href="Tutorial.md.html#片段排序">片段排序</a></li>
<li>3.2.7 <a class="el" href="Tutorial.md.html#图片时长设定">图片时长设定</a></li>
<li>3.2.8 <a class="el" href="Tutorial.md.html#移除时间线与轨道">移除时间线与轨道</a></li>
</ul>
</li>
<li>3.3 <a class="el" href="Tutorial.md.html#音乐">音乐</a><ul>
<li>3.3.1 <a class="el" href="Tutorial.md.html#添加音乐">添加音乐</a></li>
<li>3.3.2 <a class="el" href="Tutorial.md.html#视频裁剪">视频裁剪</a></li>
</ul>
</li>
<li>3.4 <a class="el" href="Tutorial.md.html#字幕">字幕</a><ul>
<li>3.4.1 <a class="el" href="Tutorial.md.html#添加与删除字幕">添加与删除字幕</a></li>
<li>3.4.2 <a class="el" href="Tutorial.md.html#获取timeline上的字幕">获取timeline上的字幕</a></li>
<li>3.4.3 <a class="el" href="Tutorial.md.html#改变字幕的属性">改变字幕的属性</a></li>
<li>3.4.4 <a class="el" href="Tutorial.md.html#改变字幕的入出点">改变字幕的入出点</a></li>
</ul>
</li>
<li>3.5 <a class="el" href="Tutorial.md.html#动画贴纸">动画贴纸</a><ul>
<li>3.5.1 <a class="el" href="Tutorial.md.html#添加与删除动画贴纸">添加与删除动画贴纸</a></li>
<li>3.5.2 <a class="el" href="Tutorial.md.html#获取timeline上的动画贴纸">获取timeline上的动画贴纸</a></li>
<li>3.5.3 <a class="el" href="Tutorial.md.html#改变动画贴纸的属性">改变动画贴纸的属性</a></li>
<li>3.5.4 <a class="el" href="Tutorial.md.html#改变动画贴纸的入出点">改变动画贴纸的入出点</a></li>
</ul>
</li>
<li>3.6 <a class="el" href="Tutorial.md.html#主题">主题</a><ul>
<li>3.6.1 <a class="el" href="Tutorial.md.html#添加与删除主题">添加与删除主题</a></li>
<li>3.6.2 <a class="el" href="Tutorial.md.html#获取timeline上的主题">获取timeline上的主题</a></li>
<li>3.6.3 <a class="el" href="Tutorial.md.html#改变主题的属性">改变主题的属性</a></li>
</ul>
</li>
<li>3.7 <a class="el" href="Tutorial.md.html#转场">转场</a></li>
<li>3.8 <a class="el" href="Tutorial.md.html#特效">特效</a><ul>
<li>3.8.1 <a class="el" href="Tutorial.md.html#视频特效">视频特效</a></li>
<li>3.8.2 <a class="el" href="Tutorial.md.html#音频特效">音频特效</a></li>
<li>3.8.3 <a class="el" href="Tutorial.md.html#时间线视频特效">时间线视频特效</a><ul>
<li>3.8.3.1 <a class="el" href="Tutorial.md.html#添加与删除时间线特效">添加与删除时间线特效</a></li>
<li>3.8.3.2 <a class="el" href="Tutorial.md.html#获取时间线特效">获取时间线特效</a></li>
<li>3.8.3.3 <a class="el" href="Tutorial.md.html#改变时间线特效的入出点">改变时间线特效的入出点</a></li>
</ul>
</li>
</ul>
</li>
<li>3.9 <a class="el" href="Tutorial.md.html#生成">生成</a></li>
<li>3.10 <a class="el" href="Tutorial.md.html#素材包管理">素材包管理</a></li>
<li>3.11 <a class="el" href="Tutorial.md.html#回调">回调</a></li>
</ul>
</li>
<li>4 <a class="el" href="Tutorial.md.html#附件">附件</a></li>
</ul>
<hr/>
 <h1><a class="anchor" id="详细内容"></a>
详细内容</h1>
<h2><a class="anchor" id="概述"></a>
1 概述</h2>
<p>美摄SDK致力于解决移动端视频开发的技术门槛，使仅有android界面开发经验的程序员，都可以开发出性能优异、渲染效果丰富的的视频录制、编辑功能。我们的优势体现在：</p><ul>
<li>录制、剪辑不限时长</li>
<li>行业最高标准的美颜效果</li>
<li>剪辑、变速实时预览，无需转码</li>
<li>图片、视频混编</li>
<li>生成视频最高支持1080p</li>
<li>丰富的转场、滤镜、字幕样式</li>
<li>独家的主题</li>
<li>支持4K制作和生成</li>
<li>未来开放的自定义贴纸功能 </li>
</ul>
<h2><a class="anchor" id="支持格式"></a>
1.1 支持格式</h2>
<ul>
<li>输入规范：<ul>
<li>视频格式：MP4、MOV、WMV、M2V、MPG</li>
<li>音频格式：MP3、FLAC、AAC、M4A</li>
<li>图片格式：JPG、PNG</li>
<li>视频编码：H264、WMV、MPEG4</li>
<li>音频编码：MP3、AAC、PCM、FLAC</li>
</ul>
</li>
<li>输出规范：<ul>
<li>视频格式：MP4</li>
<li>视频编码：H264</li>
<li>音频编码：AAC</li>
</ul>
</li>
<li>扩展包格式（扩展包是美摄用来承载扩展素材的内容包，包括主题、字幕、滤镜、贴纸等）：<ul>
<li>主题：.theme</li>
<li>字幕：.captionstyle</li>
<li>滤镜：.videofx</li>
<li>贴纸：.animatedsticker</li>
<li>转场：.videotransition </li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="注意事项"></a>
1.2 注意事项</h2>
<h2><a class="anchor" id="限制"></a>
1.2.1 限制</h2>
<p>美摄SDK的所有接口必须在UI线程调用，否则可能出现无法预料的错误。只有NvsVideoFrameRetriever类的getFrameAtTime()方法除外。 </p>
<h2><a class="anchor" id="运行环境"></a>
1.2.2 运行环境</h2>
<p>运行环境如下：android studio(必须)，android4.1以上版本，api 16 </p>
<h2><a class="anchor" id="重要提示"></a>
1.2.3 重要提示</h2>
<p>目前，安卓仅提供armeabi-v7a指令集的包。这里会产生个问题，部分其他第三方的SDK可能会提供多个指令集so,若此时第三方的客户使用64位的手机，且该应用带64位的so的时候,在loadLibrary时会出现找不到so的错误。 关于指令集的官方文档如下：<a href="https://developer.android.com/ndk/guides/abis.html?hl=is">https://developer.android.com/ndk/guides/abis.html?hl=is</a>，此链接需要翻墙才可成功。目前SDK提供的指令集：armeabi-v7a，仅提供这个版本是因为这个版本就能够兼容。 为什么报错呢？原因是用户使用的其他第三方包提供了别的指令集的的包，导致比如64位的手机会去找arm64-v8a的包。 这里建议：其他第三方包全部使用armeabi-v7的包。操作方式是在gradle命令行加入 </p><pre class="fragment">        defaultConfig { 
            ndk {
        　　  abiFilters "armeabi-v7a"
            } 
        }
</pre><p> 最后：如何查看打的包打入了so呢? 最简单的方法是使用解压工具将apk后缀修改为.zip,直接查看libs里面的so是否打入。 </p>
<h2><a class="anchor" id="快速接入"></a>
2 快速接入</h2>
<h2><a class="anchor" id="导入库文件"></a>
2.1 导入库文件</h2>
<p>如果没有SDK，请从美摄官网：<a href="https://www.meishesdk.com/doc">https://www.meishesdk.com/doc</a>下载最新andriod开发版本。导入库文件的方式有两种： <br />
方式一: 直接复制。 <br />
创建工程后，将NvStreamingSdk_Android_***_***\lib\android_jar文件夹里的两个jar包（NvAndroidStreamingSdk.jar和QtAndroid-bundled.jar），复制到工程的libs文件夹下。 同时在工程的jniLibs文件夹下（没有就创建同名文件夹），创建文件夹名为armeabi-v7a。将NvStreamingSdk_Android_***_***\lib\android_armv7里的所有.so文件，复制到刚刚创建的armeabi-v7a文件夹里。</p>
<div class="image">
<img src="loadLibrary.png" alt="loadLibrary.png"/>
</div>
<p><br />
方式二：通过配置gradle命令行方式导入库。 <br />
 美摄SDK的samples都是通过配置命令行的方式导入库文件。红线的代码用于将.so和jar包复制到正确的位置。</p>
<div class="image">
<img src="loadLibrary2.png" alt="loadLibrary2.png"/>
</div>
<h2><a class="anchor" id="使用说明"></a>
3 使用说明</h2>
<h2><a class="anchor" id="录制"></a>
3.1 录制</h2>
<p>录制的相关接口是在NvsStreamingContext类里，包括采集预览(startCapturePreview())，录制(startRecording())，添加视频采集特效(appendBuiltinCaptureVideoFx())等。强调：美摄SDK所有的类都是以“Nvs”开头。 <br />
视频录制时需要注意以下两点：</p><ul>
<li>断点录制：美摄SDK实现断点录制的方式是通过循环调用开始录制(startRecording())和结束录制(stopRecording())实现的。缺点是录制产生了多个文件，需要用户自己维护和删除视频数据， 并需要通过后续的编辑操作将断点录制的文件生成一个完整的新文件。优点是独立文件之间可以加入各种转场特技，避免了因转换场景而造成的视频画面生硬的切换。</li>
<li>带效果录制与不带效果录制：带效果录制即所见即所得，所录制文件的效果就是预览的效果。不带效果录制是预览时使用滤镜或者想要录制1:1的视频，但是录制出的文件是原始的不带滤镜的16:9或9:16的视频， 需要将视频文件在编辑时，再加上滤镜并裁剪到1:1，编辑并生成后得到的视频才会与预览时的视频完全一致。</li>
</ul>
<p>如果查看录制视频的具体功能实现，建议参考samples里的capture示例，美颜可以参考samples里的beauty示例。 </p>
<h2><a class="anchor" id="从CaptureDeviceCallback接口派生"></a>
3.1.1 从CaptureDeviceCallback接口派生</h2>
<p>录制前，录制的Activity需要实现NvsStreamingContext类的CaptureDeviceCallback接口并重写接口里的所有方法。实现代码如下： </p><pre class="fragment">        //采集设备回调接口
        public class MainActivity extends AppCompatActivity implements NvsStreamingContext.CaptureDeviceCallback {
            ......//请自行重写所有方法
        }
</pre><h2><a class="anchor" id="NvsStreamingContext类"></a>
3.1.2 NvsStreamingContext类</h2>
<p>NvsStreamingContext是美摄SDK的流媒体上下文类，可视作整个SDK框架的入口。在开始使用美摄SDK的时候，需要先初始化NvsStreamingContext类，然后在其它Activity里使用时 获取NvsStreamingContext的对象，NvsStreamingContext是单例类。在不再使用美摄SDK或者程序退出前销毁NvsStreamingContext类的对象，请务必保证不要中途销毁NvsStreamingContext 类的对象！！！NvsStreamingContext类的第二个参数为授权文件的路径，没有授权文件时给空字符串。 <br />
 NvsStreamingContext初始化代码如下： </p><pre class="fragment">        @Override
        protected void onCreate(Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            m_streamingContext = NvsStreamingContext.init(this, null);//初始化Streaming Context
            setContentView(R.layout.activity_main);
        }
</pre><p>NvsStreamingContext销毁代码如下： </p><pre class="fragment">        @Override
        protected void onDestroy() {
            //streamingContext销毁
            m_streamingContext = null;
            NvsStreamingContext.close();
        }
</pre><h2><a class="anchor" id="用NvsLiveWindow类预览"></a>
3.1.3  用NvsLiveWindow类预览</h2>
<p>录制界面的xml文件里需要使用NvsLiveWindow控件，NvsLiveWindow类是用来录制预览或者编辑预览的。xml文件设置如下： </p><pre class="fragment">        &lt;com.meicam.sdk.NvsLiveWindow
            android:layout_height="match_parent"
            android:id="@+id/liveWindow"
            android:layout_width="match_parent" 
        /&gt;
</pre><p>NvsLiveWindow的宽高比应该是1:1，4:3，16:9，9:16等，最好与采集预览startCapturePreview()的参数aspectRatio值保持一致。否则，预览的图像是录制完的视频被裁剪后的图像。 用户设置宽高比，可通过派生NvsLiveWindow类来实现自定义宽高比，代码请参考samples示例edit中的LiveWindow.java。 NvsLiveWindow的填充模式： </p><pre class="fragment">        public class NvsLiveWindow extends SurfaceView implements SurfaceHolder.Callback
        {
            //图像按比例均匀填充，必要时进行裁剪(默认模式)   
            public static final int FILLMODE_PRESERVEASPECTCROP = 0;
            //图像均匀地缩放来适合窗口，没有裁剪
            public static final int FILLMODE_PRESERVEASPECTFIT = 1;
            //图像被缩放来适合窗口
            public static final int FILLMODE_STRETCH = 2;
        }
</pre><p>对于三种填充模式，图片展示如下：</p><ul>
<li>FILLMODE_PRESERVEASPECTCROP模式： <div class="image">
<img src="PreserveAspectCrop.png" alt="PreserveAspectCrop.png"/>
</div>
</li>
<li>FILLMODE_PRESERVEASPECTFIT模式： <div class="image">
<img src="PreserveAspectFit.png" alt="PreserveAspectFit.png"/>
</div>
</li>
<li>FILLMODE_STRETCH模式： <div class="image">
<img src="Stretch.png" alt="Stretch.png"/>
</div>
</li>
</ul>
<p>另一种预览方式是通过与SurfaceTexture连接，在SurfaceView上预览显示。对应接口如下： </p><pre class="fragment">        //连接时间线和一个SurfaceTexture对象，该时间线的渲染结果将会输出到这个SurfaceTexture对象上面
        public boolean connectTimelineWithSurfaceTexture(NvsTimeline timeline, SurfaceTexture outputSurfaceTexture)

        //连接时间线和一个SurfaceTexture对象并设置代理级别，该时间线的渲染结果将会输出到这个SurfaceTexture对象上面
        public boolean connectTimelineWithSurfaceTexture(NvsTimeline timeline, SurfaceTexture outputSurfaceTexture, NvsRational proxyScale)
</pre><h2><a class="anchor" id="预览前的准备"></a>
3.1.4 预览前的准备</h2>
<pre class="fragment">        //给Streaming Context设置采集设备回调接口（必须有）
        m_streamingContext.setCaptureDeviceCallback(this);
        if (m_streamingContext.getCaptureDeviceCount() == 0)
            return;
        // 将采集预览输出连接到NvsLiveWindow控件（必须有）
        if (!m_streamingContext.connectCapturePreviewWithLiveWindow(m_liveWindow)) {
            Log.e(TAG, "Failed to connect capture preview with livewindow!");
            return;
        }
        //采集设备数量判定，如果采集设备是1，不能开启前置摄像头。
        if (m_streamingContext.getCaptureDeviceCount() &gt; 1)
            m_switchBackFacing.setEnabled(true);

        if (m_streamingContext.isCaptureDeviceBackFacing(0))//判断是否为后置采集设备
        {
            .....
        }
</pre><h2><a class="anchor" id="开启预览"></a>
3.1.5 开启预览</h2>
<p>在启动视频录制之前，要进行视频采集预览。 </p><pre class="fragment">        //启动采集预览
        m_streamingContext.startCapturePreview(m_currentDeviceIndex, NvsStreamingContext.VIDEO_CAPTURE_RESOLUTION_GRADE_SUPER_HIGH, 0, m_aspectRatio);
</pre><h2><a class="anchor" id="带美颜录制和不带美颜录制"></a>
3.1.5.1 带美颜录制和不带美颜录制</h2>
<p>采集预览时，可以在预览画面上看到添加的美颜和滤镜。在录制的时候，如果开启带特效录制，录制好的文件是带有美颜和滤镜的画面。如果不开启，则录制好的视频文件没有美颜和滤镜效果， 可以在后续的编辑功能中，再添加美颜和滤镜。若要带特效录制，则startCapturePreview()的flags参数值必须设为NvsStreamingContext.STREAMING_ENGINE_CAPTURE_FLAG_DONT_USE_SYSTEM_RECORDER，否则设为0。 <br />
更多请参考：<a href="https://www.meishesdk.com/doc_ch/html/content/videoRecorderMode.md.html">https://www.meishesdk.com/doc_ch/html/content/videoRecorderMode.md.html</a> </p>
<h2><a class="anchor" id="录制与停止录制"></a>
3.1.6 录制与停止录制</h2>
<p>录制时，文件名是.mov则录制mov格式文件，如果是.mp4则录制mp4格式文件。 </p><pre class="fragment">        m_streamingContext.startRecording(file.getAbsolutePath());//开始录制
        m_streamingContext.stopRecording();//停止录制
</pre><p>录制startRecording()的参数outputFilePath是录制视频文件的路径。停止视频录制直接调用stopRecording()即可。 </p>
<h2><a class="anchor" id="录制参数调节"></a>
3.1.7 录制参数调节</h2>
<p>切换闪光灯： </p><pre class="fragment">        m_streamingContext.toggleFlash(isChecked);
</pre><p>自动聚焦： </p><pre class="fragment">        m_streamingContext.startAutoFocus(new RectF(rectFrame));//启动自动聚焦
        m_streamingContext.cancelAutoFocus();//取消自动聚焦
</pre><p>设置缩放： </p><pre class="fragment">        m_streamingContext.setZoom(0.8);// 设置缩放值为0.8
</pre><h2><a class="anchor" id="美颜"></a>
3.1.8 美颜</h2>
<p>添加美颜特效后，在预览窗口是可以看到美颜效果的。录制视频时，用户需要根据手机性能任意选择带美颜录制或者不带美颜录制方式。美颜特效参数Strength与Whitening分别对应磨皮与美白，Samples的beauty示例的所给值即推荐值。 </p><pre class="fragment">        NvsFxDescription fxDescription = m_streamingContext.getVideoFxDescription("Beauty");//获取美颜特技描述信息
        List&lt;NvsFxDescription.ParamInfoObject&gt; paramInfo =  fxDescription.getAllParamsInfo();//获取描述的所有参数信息
        for (NvsFxDescription.ParamInfoObject param:paramInfo) {
            String paramName = param.getString("paramName");
            if (paramName.equals("Strength")) {
                double maxValue = param.getFloat("floatMaxVal");//获取美颜磨皮最大值
                m_strengthValue = param.getFloat("floatDefVal");//获取美颜磨皮当前值
            }
        }

        NvsCaptureVideoFx fx = m_streamingContext.appendBeautyCaptureVideoFx();//添加美颜采集特效
        fx.setFloatVal("Strength", m_strengthValue);//设置美颜磨皮值
        fx.setFloatVal("Whitening", m_whiteningValue);//设置美白强度值
</pre><h2><a class="anchor" id="采集特效（滤镜）"></a>
3.1.9 采集特效（滤镜）</h2>
<p>采集特效分为两种，内建采集特效和扩展采集特效，扩展采集特效即通过资源包安装而得到的采集特效。资源包包括主题包，字幕样式包，动画贴纸包，转场包，滤镜包等。 </p>
<h2><a class="anchor" id="内建采集特效"></a>
3.1.9.1 内建采集特效</h2>
<p>内建采集特效名称列表可以参考：<a href="https://www.meishesdk.com/doc_ch/html/content/FxNameList.md.html">https://www.meishesdk.com/doc_ch/html/content/FxNameList.md.html</a>。 <br />
添加与移除特效： </p><pre class="fragment">        //获取所有内建采集特效的名称
        m_streamingContext.getAllBuiltinCaptureVideoFxNames();

        //添加内建采集特效
        m_streamingContext.appendBuiltinCaptureVideoFx(fxName);
        //移除所有采集视频特效
        m_streamingContext.removeAllCaptureVideoFx();
</pre><h2><a class="anchor" id="扩展采集特效"></a>
3.1.9.2 扩展采集特效</h2>
<p>添加扩展采集特效时，首先需要安装扩展采集特效所对应的资源包，获取资源包对应的包ID值，然后才可添加扩展采集特效。 </p><pre class="fragment">        //安装一个视频采集特效包，此处采用同步安装方式，如果资源包尺寸太大或者根据需要可使用异步安装方式
        String package1Path = "assets:/7FFCF99A-5336-4464-BACD-9D32D5D2DC5E.videofx";
        m_fxPackageId = new StringBuilder();
        int error = m_streamingContext.getAssetPackageManager().installAssetPackage(package1Path, null, NvsAssetPackageManager.ASSET_PACKAGE_TYPE_VIDEOFX, true, m_fxPackageId);
        if (error != NvsAssetPackageManager.ASSET_PACKAGE_MANAGER_ERROR_NO_ERROR
                &amp;&amp; error != NvsAssetPackageManager.ASSET_PACKAGE_MANAGER_ERROR_ALREADY_INSTALLED) {
            Log.e(TAG, "Failed to install asset package!");
        }

        //添加扩展采集特效
        m_streamingContext.appendPackagedCaptureVideoFx(m_fxPackageId.toString());
</pre><h2><a class="anchor" id="编辑"></a>
3.2 编辑</h2>
<p>实现视频编辑的一般步骤：</p><ul>
<li>先初始化NvsStreamingContext。如果已经初始化过，则直接获取对象。 <pre class="fragment">  //NvsStreamingContext初始化
  m_streamingContext = NvsStreamingContext.getInstance(); // m_streamingContext对象
</pre></li>
<li>创建时间线(timeline)。通过NvsStreamingContext类对象创建时间线，时间线占用资源较小，如有需要，一个程序中可以创建多个时间线。一般创建一条时间线即可。</li>
<li>添加轨道，包括视频轨道(VideoTrack)与音频轨道(AudioTrack)。时间线上可以添加视频轨道和音频轨道，而在视频轨道上添加视频片段，音频轨道上添加音频片段。如果要实现画中画，则可添加两条视频轨道。添加音频轨道一般用来给视频加音乐或者配音功能。</li>
<li>把素材片段添加到轨道上。视频轨道上可以添加多个片段，可以是视频文件或者图片，实现图片和视频的混编。音频轨道上也可以添加多个音乐文件。</li>
</ul>
<p>视频编辑里包含播放和生成视频，所以编辑的Activity需要实现两个回调接口及其对应的所有方法。实现代码： </p><pre class="fragment">        //CompileCallback 生成回调接口
        //PlaybackCallback 播放回调接口
        public class MainActivity extends AppCompatActivity implements NvsStreamingContext.CompileCallback,
        NvsStreamingContext.PlaybackCallback{
            ......//请自行重写所有方法
        }
</pre><p>编辑功能的具体实现请参考samples里面的edit。Mediapicker这个module是第三方的代码，用来从手机里选取图片和视频文件的，与美摄SDK无关。 </p>
<h2><a class="anchor" id="创建timeline设定视频尺寸"></a>
3.2.1 创建timeline设定视频尺寸</h2>
<p>创建timeline对于编辑是非常关键的，timeline的分辨率决定了生成视频文件的最大分辨率（尺寸）。请将timeline的分辨率和NvsLiveWindow的宽高比适配一致。 </p><pre class="fragment">        NvsVideoResolution videoEditRes = new NvsVideoResolution();
        /*
            注意：请在使用LiveWindow预览的时候，将NvsLiveWindow的宽高比与此处保持一致。
        */
        videoEditRes.imageWidth = 1280; /*视频分辨率的宽*/
        videoEditRes.imageHeight = 720; /*视频分辨率的高*/
        videoEditRes.imagePAR = new NvsRational(1, 1); /*像素比，设为1:1*/
        NvsRational videoFps = new NvsRational(25, 1); /*帧速率，代表1秒播出多少帧画面，一般设25帧，也可设为30 */

        NvsAudioResolution audioEditRes = new NvsAudioResolution();
        audioEditRes.sampleRate = 44100; /*音频采样率，可以是44100，或者48000*/
        audioEditRes.channelCount = 2; /*音频通道数,一般是2*/

        /*创建时间线*/
        m_timeline = m_streamingContext.createTimeline(videoEditRes, videoFps, audioEditRes);
        //将timeline连接到LiveWindow控件
        m_streamingContext.connectTimelineWithLiveWindow(m_timeline,m_liveWindow);
        m_streamingContext.setCompileCallback(this);//设置生成回调接口
        m_streamingContext.setPlaybackCallback(this);//设置播放回调接口
</pre><h2><a class="anchor" id="多段视频、图片混编"></a>
3.2.2 多段视频、图片混编</h2>
<p>创建视频轨道，一般情况下是创建一条视频轨道。创建完轨道之后，往轨道上添加图片或者视频素材。添加到轨道上的素材，我们称它为片段（clip)。图片和视频素材都是 通过文件路径添加到轨道上的。唯一的区别是图片素材如果尺寸过大，需要降低图片尺寸，降低尺寸后的图片和创建timeline的分辨率的尺寸大小匹配最好。 </p><pre class="fragment">        /*添加视频轨道，如果不做画中画，添加一条视频轨道即可*/
        m_videoTrack = m_timeline.appendVideoTrack();
        //通过素材文件路径添加素材，可以是图片或者视频
        for(int i = 0; i &lt; pathList.size(); i++) {
            /*
                添加片段到轨道上，建议判断返回值查看片段是否添加成功
            */
            NvsVideoClip clip = m_videoTrack.appendClip(pathList.get(i));
        }
</pre><h2><a class="anchor" id="播放与定位预览"></a>
3.2.3 播放与定位预览</h2>
<p>对于播放与定位预览接口，其参数videoSizeMode建议设置为NvsStreamingContext.VIDEO_PREVIEW_SIZEMODE_LIVEWINDOW_SIZE。若无特殊需求，设为NvsStreamingContext.VIDEO_PREVIEW_SIZEMODE_FULLSIZE的模式会影响性能。 preload是预加载，设为true。美摄SDK的时间单位是微秒，1/1000000秒。 <br />
 视频播放： </p><pre class="fragment">        //playbackTimeline()的参数endTime，值可以是_timeline.duration或者-1
        m_streamingContext.playbackTimeline(m_timeline, m_streamingContext.getTimelineCurrentPosition(m_timeline), -1, NvsStreamingContext.VIDEO_PREVIEW_SIZEMODE_LIVEWINDOW_SIZE, true, 0);
</pre><p>视频定位预览： </p><pre class="fragment">        m_streamingContext.seekTimeline(m_timeline, 0, NvsStreamingContext.VIDEO_PREVIEW_SIZEMODE_LIVEWINDOW_SIZE, 0);
</pre><h2><a class="anchor" id="视频裁剪"></a>
3.2.4 视频裁剪</h2>
<pre class="fragment">        NvsVideoClip clip = m_videoTrack.getClipByIndex(m_currentPosition);
        /*
            改变片段的入出点，裁剪片段。第二个参数请设置为true。
        */
        clip.changeTrimInPoint((long)trim_in, true);
        clip.changeTrimOutPoint((long)trim_out, true);
</pre><h2><a class="anchor" id="从轨道上移除片段"></a>
3.2.5 从轨道上移除片段</h2>
<pre class="fragment">        //clipIndex代表轨道上片段的位置,keepSpace请填false。
        m_videoTrack.removeClip(0, false);
</pre><h2><a class="anchor" id="片段排序"></a>
3.2.6 片段排序</h2>
<p>轨道上的片段可以互换位置。 </p><pre class="fragment">        /*
            clipIndex和destClipIndex分别代表互换的两个素材的位置索引
        */
        m_videoTrack.moveClip(0,3);
</pre><h2><a class="anchor" id="图片时长设定"></a>
3.2.7 图片时长设定</h2>
<p>NvsVideoTrack类提供appendClip(String filePath, long trimIn, long trimOut)可以根据需要自由设定图片时长。同样，添加的是视频，亦可如此设置。 </p><pre class="fragment">        /*
            追加片段,filePath是图片素材的路径，trimIn设置0，trimOut设置为8000000，则图片显示为8秒。
        */
        m_videoTrack.appendClip(pathList.get(i),0,8000000); 
</pre><p>如果通过appendClip(String filePath)这个方法添加的图片，则图片默认显示时长是4秒。 </p>
<h2><a class="anchor" id="移除时间线与轨道"></a>
3.2.8 移除时间线与轨道</h2>
<p>在程序退出时，要对创建的时间线，添加的视频轨道和音频轨道进行移除。操作如下： <br />
移除时间线： </p><pre class="fragment">        //移除时间线
        m_streamingContext.removeTimeline(m_timeline);
</pre><p>移除视频轨道： </p><pre class="fragment">        // 移除指定索引值的视频轨道
        m_timeline.removeVideoTrack(0);
</pre><p>移除音频轨道： </p><pre class="fragment">        // 移除指定索引值的音频轨道
        m_timeline.removeAudioTrack(0);
</pre> <h2><a class="anchor" id="音乐"></a>
3.3 音乐</h2>
<h2><a class="anchor" id="添加音乐"></a>
3.3.1 添加音乐</h2>
<p>给视频添加音乐是通过添加一条音频轨道实现的。创建时间线后，通过appendAudioTrack()添加一条音频轨道，然后把音乐的文件添加到音频轨道上，可以添加多段音乐，音乐会连续播放。 </p><pre class="fragment">        //添加音频轨道
        m_audioTrack =  m_timeline.appendAudioTrack();
        /*
            filePath是音频文件的路径。支持的格式见1.1功能特点。
        */
        m_audioTrack.appendClip(pathList.get(i));
</pre><h2><a class="anchor" id="音乐裁剪"></a>
3.3.2 音乐裁剪</h2>
<p>音乐裁剪与视频裁剪是一样的，也是通过设置入出点的方式进行裁剪。 </p><pre class="fragment">        NvsAudioClip clip = m_audioTrack.getClipByIndex(m_currentPosition);
        /*
            改变片段的入出点，裁剪片段。第二个参数请设置为true。
        */
        clip.changeTrimInPoint((long)trim_in, true);
        clip.changeTrimOutPoint((long)trim_out, true);  
</pre><h2><a class="anchor" id="字幕"></a>
3.4 字幕</h2>
<p>字幕添加可以参考samples里面caption这个示例。在时间线(timeline)上可以添加，删除以及获取字幕。 </p>
<h2><a class="anchor" id="添加与删除字幕"></a>
3.4.1 添加与删除字幕</h2>
<p>添加字幕： </p><pre class="fragment">         // 在时间线上添加字幕，返回添加的字幕对象
         NvsTimelineCaption m_timelineCapion = m_timeline.addCaption("美摄SDK", 0, m_timeline.getDuration(), null);
</pre><p>移除字幕： </p><pre class="fragment">        //移除时间上的字幕,返回下一个时间线字幕对象
         NvsTimelineCaption nextCaption = m_timeline.removeCaption(m_timelineCapion);
</pre><h2><a class="anchor" id="获取timeline上的字幕"></a>
3.4.2 获取timeline上的字幕</h2>
<p>获取字幕各个接口如下： </p><pre class="fragment">        //获得时间线上的第一个字幕
        public NvsTimelineCaption getFirstCaption()

        //获得时间线上的最后一个字幕
        public NvsTimelineCaption getLastCaption()

        //获得时间线上的当前字幕的前一个字幕
        public NvsTimelineCaption getPrevCaption(NvsTimelineCaption caption)

        //获得时间线上的当前字幕的后一个字幕
        public NvsTimelineCaption getNextCaption(NvsTimelineCaption caption)

        /*
            根据时间线上的位置获得字幕,返回保存当前位置字幕的List集合。获取的字幕列表排序规则如下：
            1.添加时字幕入点不同，按入点的先后顺序排列；
            2.添加时字幕入点相同，按添加字幕的先后顺序排列。
        */
        public List&lt;NvsTimelineCaption&gt; getCaptionsByTimelinePosition(long timelinePos)
</pre><h2><a class="anchor" id="改变字幕的属性"></a>
3.4.3 改变字幕的属性</h2>
<p>字幕属性的设置都是在NvsTimelineCaption类里实现的。获取字幕之后，即可设置下列属性。 </p><pre class="fragment">        //设置字幕文本
        public void setText(String text)
        //获取字幕文本
        public String getText()

        //设置字幕字体加粗
        public void setBold(boolean bold)
        //获取字幕字体加粗状态
        public boolean getBold()

        //设置字幕字体斜体
        public void setItalic(boolean italic)
        //获取字幕斜体状态
        public boolean getItalic()

        //设置字幕文本颜色
        public void setTextColor(NvsColor textColor)
        //获取字幕字体的当前颜色值
        public NvsColor getTextColor()

        //设置字幕描边
        public void setDrawOutline(boolean drawOutline)
        //获取字幕描边状态
        public boolean getDrawOutline()

        //设置字幕描边的颜色
        public void setOutlineColor(NvsColor outlineColor)
        //获取当前字幕描边的颜色值
        public NvsColor getOutlineColor()

        //设置字幕描边的宽度
        public void setOutlineWidth(float outlineWidth)
        //获取当前字幕描边的宽度
        public float getOutlineWidth()

        //设置字幕阴影
        public void setDrawShadow(boolean drawShadow)
        //获取当前字幕阴影状态
        public boolean getDrawShadow()

        //设置字幕阴影的颜色
        public void setShadowColor(NvsColor shadowColor)
        //获取当前字幕阴影的颜色
        public NvsColor getShadowColor()

        // 设置字幕阴影的偏移量
        public void setShadowOffset(PointF shadowOffset)
        //获取当前字幕阴影的偏移量
        public PointF getShadowOffset()

        //设置字幕字体大小
        public void setFontSize(float fontSize)
        //获取当前字幕的字体大小
        public float getFontSize()

        //设置字幕字体
        public void setFontByFilePath(String filePath)      
        //字幕平移
        public void setCaptionTranslation(PointF translation)
</pre><p>如果是全景图字幕，则需要设置下列属性： </p><pre class="fragment">        //对字幕设置中心点的极角。
        public void setCenterPolarAngle(float centerPolarAngle)
        //对字幕设置中心点的方位角。
        public void setCenterAzimuthAngle(float centerAzimuthAngle)
        //对字幕设置极角的张角。
        public void setPolarAngleRange(float polarAngleRange)
</pre><h2><a class="anchor" id="改变字幕的入出点"></a>
3.4.4 改变字幕的入出点</h2>
<pre class="fragment">        //获取字幕在时间线上显示的入点
        public long getInPoint()

        //获取字幕在时间线显示上的出点
        public long getOutPoint()

        //改变字幕在时间线上显示的入点
        public long changeInPoint(long newInPoint)

        //改变字幕在时间线上显示的出点
        public long changeOutPoint(long newOutPoint)

        //改变字幕在时间线上的显示位置(入点和出点同时偏移offset值)
        public void movePosition(long offset)   
</pre><h2><a class="anchor" id="动画贴纸"></a>
3.5 动画贴纸</h2>
<p>添加，删除以及获取动画贴纸也是在时间线(timeline)上进行操作的。 </p>
<h2><a class="anchor" id="添加与删除动画贴纸"></a>
3.5.1 添加与删除动画贴纸</h2>
<pre class="fragment">        //添加动画贴纸
        m_timeline.addAnimatedSticker(0, m_timeline.getDuration(), m_stickerId.toString());

        // 移除动画贴纸，返回当前贴纸的下一下贴纸
        NvsTimelineAnimatedSticker sticker = m_timeline.getFirstAnimatedSticker();
        m_timeline.removeAnimatedSticker(sticker);
</pre><h2><a class="anchor" id="获取timeline上的动画贴纸"></a>
3.5.2 获取timeline上的动画贴纸</h2>
<p>时间线上有多个接口用来获取添加的动画贴纸。 </p><pre class="fragment">        //获取时间线上第一个动画贴纸
        public NvsTimelineAnimatedSticker getFirstAnimatedSticker()
        //获取时间线上最后一个动画贴纸
        public NvsTimelineAnimatedSticker getLastAnimatedSticker()
        //获取时间线当前动画贴纸的前一个动画贴纸
        public NvsTimelineAnimatedSticker getPrevAnimatedSticker(NvsTimelineAnimatedSticker animatedSticker)
        //获取时间线当前动画贴纸的后一个动画贴纸
        public NvsTimelineAnimatedSticker getNextAnimatedSticker(NvsTimelineAnimatedSticker animatedSticker)
        /*
            根据时间线上的位置获得动画贴纸,返回保存当前位置动画贴纸对象的List集合
            获取的动画贴纸列表排序规则如下：
            1.添加时入点不同，按入点的先后顺序排列；
            2.添加时入点相同，按添加动画贴纸的先后顺序排列。
        */
        public List&lt;NvsTimelineAnimatedSticker&gt; getAnimatedStickersByTimelinePosition(long timelinePos)
</pre><h2><a class="anchor" id="改变动画贴纸的属性"></a>
3.5.3 改变动画贴纸的属性</h2>
<pre class="fragment">        //设置动画贴纸的缩放值
        public void setScale(float scale)
        //设置动画贴纸的水平翻转
        public void setHorizontalFlip(boolean flip)
        //设置动画贴纸的竖直翻转
        public void setVerticalFlip(boolean flip)
        //设置动画贴纸的旋转角度
        public void setRotationZ(float angle)
        //设置动画贴纸的平移
        public void setTranslation(PointF translation)
</pre><p>如果是全景图动画贴纸，则还可以设置下列属性： </p><pre class="fragment">        //对动画贴纸设置中心点的极角。
        public void setCenterPolarAngle(float centerPolarAngle)
        //对动画贴纸设置中心点的方位角。
        public void setCenterAzimuthAngle(float centerAzimuthAngle)
        //对动画贴纸设置极角的张角。
        public void setPolarAngleRange(float polarAngleRange)
</pre><h2><a class="anchor" id="改变动画贴纸的入出点"></a>
3.5.4 改变动画贴纸的入出点</h2>
<pre class="fragment">        //改变动画贴纸在时间线上显示的入点
        public long changeInPoint(long newInPoint)
        //改变动画贴纸在时间线上显示的出点
        public long changeOutPoint(long newOutPoint)
        //改变动画贴纸在时间线上的显示位置(入点和出点同时偏移offset值)
        public void movePosition(long offset)
</pre><h2><a class="anchor" id="主题"></a>
3.6 主题</h2>
<p>编辑视频时，如果需要运用主题，则可通过时间线(timeline)实现添加，移除以及获取。 </p>
<h2><a class="anchor" id="添加与删除主题"></a>
3.6.1 添加与删除主题</h2>
<pre class="fragment">        // 运用主题
        m_timeline.applyTheme(m_themeId.toString());

        //移除主题
        m_timeline.removeCurrentTheme();
</pre><h2><a class="anchor" id="获取timeline上的主题"></a>
3.6.2 获取timeline上的主题</h2>
<pre class="fragment">        // 获取当前主题
        m_timeline.getCurrentThemeId();
</pre><h2><a class="anchor" id="改变主题的属性"></a>
3.6.3 改变主题的属性</h2>
<pre class="fragment">        //设置主题片头的字幕文本
        public void setThemeTitleCaptionText(String text)
        //设置主题片尾的字幕文本
        public void setThemeTrailerCaptionText(String text)
        //设置主题音乐音量
        public void setThemeMusicVolumeGain(float leftVolumeGain, float rightVolumeGain)
</pre><h2><a class="anchor" id="转场"></a>
3.7 转场</h2>
<p>转场包括视频转场和音频转场。视频转场是在视频轨道上设置的，音频转场是在音频轨道上设置的。 <br />
视频转场： </p><pre class="fragment">        //视频转场包括内嵌式转场和包裹式转场，这里设置内嵌转场
        for(int i = 0;i&lt;m_videoTrack.getClipCount();i++) {
            m_videoTrack.setBuiltinTransition(i,transitionName);
        }

        // 包裹式转场
        m_videoTrack.setPackagedTransition(m_transitionId.toString());
</pre><p>音频转场： </p><pre class="fragment">        //设置音频转场
        for(int i = 0;i&lt;m_videoTrack.getClipCount();i++) {
            m_audioTrack.setBuiltinTransition(i,transitionName);
        }
</pre><h2><a class="anchor" id="特效"></a>
3.8 特效</h2>
<p>视频录制完成后，在后续制作中，经常会使用到几种特效，分别是视频特效(NvsVideoFx)，音频特效(NvsAudioFx)，时间线视频特效(NvsTimelineVideoFx)。 </p>
<h2><a class="anchor" id="视频特效"></a>
3.8.1 视频特效</h2>
<p>视频特效是使用在视频片段上的，每个视频片段可以添加若干个视频特效。视频特效包括内嵌视频特效，包裹视频特效，美颜特效。 <br />
内嵌视频特效： </p><pre class="fragment">        //添加内嵌视频特效
        videoClip.appendBuiltinFx(fxName);
</pre><p>包裹视频特效： </p><pre class="fragment">        //追加包裹特效
        videoClip.appendPackagedFx(m_fxPackageId.toString());//添加包裹特效    
</pre><p>美颜特效： </p><pre class="fragment">        // 追加美颜特效
        videoClip.appendBeautyFx();
</pre><p>视频特效移除： </p><pre class="fragment">        //移除指定索引值的特效
        videoClip.removeFx(0);
        //清除所有特效
        videoClip.removeAllFx();
</pre><h2><a class="anchor" id="音频特效"></a>
3.8.2 音频特效</h2>
<p>音频特效是使用在音频片段上的，每个音频片段可以添加若干个音频特效。 <br />
音频特效添加： </p><pre class="fragment">        //添加音频特效
        audioClip.appendFx(fxName);
</pre><p>音频特效移除： </p><pre class="fragment">        //移除指定索引的音频特效
        audioClip.removeFx(0);
</pre><h2><a class="anchor" id="时间线视频特效"></a>
3.8.3 时间线视频特效</h2>
<p>时间线视频特效，简单说，就是在时间线上使用的一种特效，包含内嵌特效和包裹特效。时间线上可以添加若干个时间线视频特效。 </p>
<h2><a class="anchor" id="添加与删除时间线特效"></a>
3.8.3.1 添加与删除时间线特效</h2>
<p>时间线特效添加： </p><pre class="fragment">        //添加内建时间线特效
        for (int i = 0;i&lt;m_videoTrack.getClipCount();i++) {
            NvsVideoClip videoClip = m_videoTrack.getClipByIndex(i);
            m_timeline.addBuiltinTimelineVideoFx(videoClip.getInPoint(),(videoClip.getOutPoint() - videoClip.getInPoint()),fxName);
        }

        //添加包裹时间线特效
        for (int i = 0;i&lt;m_videoTrack.getClipCount();i++) {
            NvsVideoClip videoClip = m_videoTrack.getClipByIndex(i);
            m_timeline.addPackagedTimelineVideoFx(videoClip.getInPoint(),(videoClip.getOutPoint() - videoClip.getInPoint()),fxPackageId);
        }
</pre><h2><a class="anchor" id="获取时间线特效"></a>
3.8.3.2 获取时间线特效</h2>
<pre class="fragment">        //获取时间线上第一个时间线视频特效
        public NvsTimelineVideoFx getFirstTimelineVideoFx()
        //获取时间线上最后一个时间线视频特效
        public NvsTimelineVideoFx getLastTimelineVideoFx()
        //获取时间线上某个时间线视频特效的前一个时间线视频特效
        public NvsTimelineVideoFx getPrevTimelineVideoFx(NvsTimelineVideoFx videoFx)
        //获取时间线上某个时间线视频特效的下一个时间线视频特效
        public NvsTimelineVideoFx getNextTimelineVideoFx(NvsTimelineVideoFx videoFx)
        /*
            根据时间线上的位置获得时间线视频特效,返回当前位置时间线视频特效对象的数组
            获取的时间线视频特效数组排序规则如下：
            1.添加时入点不同，按入点的先后顺序排列；
            2.添加时入点相同，按添加时间线视频特效的先后顺序排列。
        */
        public List&lt;NvsTimelineVideoFx&gt; getTimelineVideoFxByTimelinePosition(long timelinePos)
</pre><h2><a class="anchor" id="改变时间线特效的入出点"></a>
3.8.3.3 改变时间线特效的入出点</h2>
<pre class="fragment">        //改变时间线视频特效在时间线上的入点
        public long changeInPoint(long newInPoint)
        //改变时间线视频特效在时间线上的出点
        public long changeOutPoint(long newOutPoint)
        //改变时间线视频特效在时间线上的位置(入点和出点同时偏移offset值)
        public void movePosition(long offset)
</pre><h2><a class="anchor" id="生成"></a>
3.9 生成</h2>
<p>美摄SDK使用compileTimeline()用于将时间线上的片段生成输出一个新的视频。 </p><pre class="fragment">        //生成视频
        m_streamingContext.compileTimeline(m_timeline, 0, m_timeline.getDuration(),
            m_compilePath, NvsStreamingContext.COMPILE_VIDEO_RESOLUTION_GRADE_720, NvsStreamingContext.COMPILE_BITRATE_GRADE_HIGH, 0);
</pre><p>对应参数解释如下：</p><ul>
<li>参数1 时间线。</li>
<li>参数2 开始时间，从时间线上哪个时间开始生成。一般从0开始生成。</li>
<li>参数3 结束时间，时间线上哪个时间作为结束时间，一般是整个时间线的时长。</li>
<li>参数4 生成素材的文件路径。</li>
<li>参数5 生成视频的分辨率高度级别。可以是360，480，720，1080。和Timeline的分辨率共同决定了生成素材的分辨率。假如此处高度是480，低于Timeline的高， 那么生成的素材的分辨率的高就是480，宽是480乘以Timeline的分辨率的横纵比。如果此处的高大于timeline的分辨率的高，则生成视频的分辨率就是Timeline 的分辨率。</li>
<li>参数6 码率级别。分为高，中，低三类。决定了生成素材的清晰度，级别越高，码率越大，越清晰，视频文件也越大。所以一般是生成到本地的素材，采用高或中。准备发布到服务器上的素材，生成为中或低，节省CDN费用。 生成素材的分辨率也会影响码率，分辨率越大，码率越大，视频文件也越大，请根据使用场景自行决定。</li>
<li>参数7 生成文件输出的特殊标志，如果没有特殊需求，一般设置为0。除非特例非常介意文件的大小，又完全不介意生成文件所花的时间，可设置STREAMING_ENGINE_COMPILE_FLAG_DISABLE_HARDWARE_ENCODER。 将禁止硬件编码器而采用软件编码器，文件大小降低一半，但生成时间是原来的2至3倍。请根据使用场景自行设定。</li>
</ul>
<h2><a class="anchor" id="素材包管理"></a>
3.10 素材包管理</h2>
<p>美摄SDK提供了丰富的素材库，包括动画贴纸，主题，字幕样式，转场等。素材包可以从网络上下载，或者由美摄SDK项目组提供，用户可以根据需要选择使用这些素材包。美摄SDK通过NvsAssetPackageManager类对这些素材包进行管理，可以安装，升级，卸载,获取素材包的状态，版本号等。 <br />
素材包安装： </p><pre class="fragment">        //此处采用同步安装方式，如果包裹过大可采用异步方式
        int error = m_streamingContext.getAssetPackageManager().installAssetPackage(stickerPackagePath, null, NvsAssetPackageManager.ASSET_PACKAGE_TYPE_ANIMATEDSTICKER, true, m_stickerId);
</pre><p>素材包安装: </p><pre class="fragment">        //此处采用同步升级方式，如果包裹过大可采用异步方式
        int error = m_streamingContext.getAssetPackageManager().upgradeAssetPackage(stickerPackagePath, null, NvsAssetPackageManager.ASSET_PACKAGE_TYPE_ANIMATEDSTICKER, true, m_stickerId);
</pre><p>素材包卸载: </p><pre class="fragment">        //素材包卸载
        int error = m_streamingContext.getAssetPackageManager().uninstallAssetPackage(m_stickerId,NvsAssetPackageManager.ASSET_PACKAGE_TYPE_ANIMATEDSTICKER);
</pre><h2><a class="anchor" id="回调"></a>
3.11 回调</h2>
<p>美摄SDK提供了很多回调接口，如果要查询采集设备状态，采集录制状态，视频播放状态，文件生成状态，资源包安装状态等，则必须在创建NvsStreamingContext对象后设置回调并实现对应的回调方法。 <br />
这里举例设置播放回调： </p><pre class="fragment">        //给Streaming context设置播放回调接口
        m_streamingContext.setPlaybackCallback(this);
</pre><h2><a class="anchor" id="附件"></a>
4 附件</h2>
<p>美摄SDK版本包括极速版，标准功能版，全功能PRO版，对于每个版本产品的功能点，请参考：<a href="https://www.meishesdk.com/editsdk">https://www.meishesdk.com/editsdk</a>，会有详细介绍。每个用户可根据个人需要选择使用，具体请联系美摄商务。 </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
制作者 &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
